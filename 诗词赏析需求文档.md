# 诗词赏析网站需求文档

## 1. 引言

### 1.1 项目背景

随着互联网技术的发展和人们对传统文化兴趣的日益增长，诗词赏析作为中华文化的重要组成部分，越来越受到关注。然而，现有的诗词赏析平台在用户体验、内容丰富度、互动性等方面仍有提升空间。本项目旨在开发一个现代化的诗词赏析网站，提供丰富的诗词内容、便捷的搜索功能、高质量的赏析文章以及互动社区，以满足广大诗词爱好者的需求。

### 1.2 项目目标

*   **提供全面的诗词库**：收录经典和现代诗词，并提供详细的作者、背景、注释等信息。
*   **增强用户互动体验**：允许用户提交、分享赏析文章，并进行评论、点赞和收藏。
*   **优化内容发现机制**：通过搜索、筛选和推荐功能，帮助用户快速找到感兴趣的诗词和赏析。
*   **构建稳定高效的平台**：采用现代前端框架 Vue.js 和后端服务 Supabase，确保网站的性能、安全性和可扩展性。

### 1.3 范围

本需求文档涵盖诗词赏析网站的以下主要功能模块：用户管理、诗词浏览与搜索、赏析与评论。后台管理模块将根据项目进展和资源情况决定是否在第一阶段实现。

### 1.4 目标用户

*   **诗词爱好者**：对中国传统诗词有浓厚兴趣，希望学习、欣赏和分享诗词的用户。
*   **学生和研究者**：需要查阅诗词资料、参考赏析文章进行学习和研究的用户。
*   **内容创作者**：希望分享自己的诗词赏析和见解的用户。

## 2. 功能需求

### 2.1 用户管理
#### 2.1.1 注册/登录

*   **用户注册**：用户可以通过邮箱和密码进行注册，注册后需进行邮箱验证。
*   **用户登录**：用户可以使用注册的邮箱和密码登录，支持记住登录状态。
*   **第三方登录**：支持通过微信、GitHub等第三方平台快速登录（可选）。
*   **密码找回**：提供密码重置功能。

#### 2.1.2 个人资料管理

*   **查看个人资料**：用户可以查看自己的昵称、头像、注册时间、发布的赏析和评论等信息。
*   **编辑个人资料**：用户可以修改昵称、上传头像、修改密码等。

### 2.2 诗词浏览与搜索

#### 2.2.1 诗词列表展示

*   **分页展示**：首页或诗词列表页分页展示诗词，支持按时间、热度等排序。
*   **分类浏览**：支持按朝代、作者、体裁（如唐诗、宋词、律诗、绝句）等分类浏览。

#### 2.2.2 诗词详情页

*   **诗词原文**：展示诗词的完整原文。
*   **作者信息**：展示作者的简介、生平事迹等。
*   **背景介绍**：提供诗词创作的时代背景、文化背景等。
*   **注释译文**：提供诗词中生僻字词的注释和白话译文。
*   **推荐赏析**：展示与该诗词相关的优秀赏析文章。

#### 2.2.3 搜索与筛选

*   **关键词搜索**：支持按诗词标题、内容、作者姓名等关键词进行模糊搜索。
*   **高级筛选**：提供按朝代、作者、体裁、诗词类型等多种条件进行组合筛选。

### 2.3 赏析与评论

#### 2.3.1 提交赏析

*   **赏析创作**：注册用户可以针对特定诗词提交自己的赏析文章，支持富文本编辑。
*   **草稿保存**：支持将未完成的赏析保存为草稿。
*   **发布与管理**：用户可以发布、编辑和删除自己已发布的赏析。

#### 2.3.2 评论功能

*   **评论诗词**：用户可以在诗词详情页对诗词进行评论。
*   **评论赏析**：用户可以对其他用户发布的赏析文章进行评论。
*   **回复评论**：支持对评论进行回复，形成评论链。

#### 2.3.3 点赞/收藏

*   **点赞**：用户可以对诗词、赏析和评论进行点赞。
*   **收藏**：用户可以收藏喜欢的诗词和赏析，并在个人中心查看。

### 2.4 后台管理 (可选，根据需求决定是否包含)

*   **诗词内容管理**：管理员可以添加、编辑、删除诗词信息，包括原文、作者、背景、注释等。
*   **用户管理**：管理员可以查看、编辑用户信息，禁用或删除违规用户。
*   **赏析与评论审核**：管理员可以审核用户提交的赏析和评论，对违规内容进行删除或隐藏。

## 3. 非功能需求

### 3.1 性能

*   **响应时间**：页面加载时间应在3秒以内，API响应时间应在1秒以内。
*   **并发用户**：系统应能支持至少1000个并发用户访问，并保持良好性能。
*   **可扩展性**：系统架构应具备良好的可扩展性，以应对未来用户量和数据量的增长。

### 3.2 安全性

*   **用户数据安全**：用户密码应加密存储，敏感信息传输应采用HTTPS协议。
*   **认证与授权**：利用 Supabase 的认证服务，实现用户身份验证和基于角色的访问控制（RLS）。
*   **防范常见攻击**：系统应能有效防范SQL注入、XSS、CSRF等常见的Web安全攻击。

### 3.3 可用性

*   **界面友好**：提供直观、简洁的用户界面，易于操作和理解。
*   **错误处理**：系统应提供清晰的错误提示和友好的错误页面。
*   **兼容性**：支持主流浏览器（Chrome, Firefox, Edge, Safari）的最新版本，并兼容移动设备访问。

### 3.4 可维护性

*   **代码规范**：前端和后端代码应遵循统一的编码规范，具备良好的可读性和可维护性。
*   **文档完善**：提供详细的开发文档、API文档和部署文档。
*   **日志记录**：系统应具备完善的日志记录功能，便于故障排查和性能监控。

### 3.5 兼容性

*   **浏览器兼容**：支持主流现代浏览器（如Chrome, Firefox, Edge, Safari）的最新两个版本。
*   **移动设备兼容**：网站应具备响应式设计，适配不同尺寸的移动设备屏幕。

## 4. 技术架构

### 4.1 前端技术栈 (Vue)

*   **核心框架**：Vue.js 3 (Composition API)
*   **路由管理**：Vue Router
*   **状态管理**：Pinia (或 Vuex)
*   **UI 组件库**：Element Plus, Ant Design Vue 或 Quasar (根据设计需求选择)
*   **CSS 预处理器**：Sass/Less (可选)
*   **构建工具**：Vite

### 4.2 后端技术栈 (Supabase)

*   **数据库**：PostgreSQL (Supabase 提供)
*   **认证服务**：Supabase Auth (支持邮箱/密码、OAuth)
*   **实时服务**：Supabase Realtime (用于评论、点赞等实时更新)
*   **存储服务**：Supabase Storage (用于存储用户头像、诗词相关图片等)
*   **边缘函数**：Supabase Edge Functions (可选，用于自定义后端逻辑)

### 4.3 部署方案

*   **前端部署**：可部署至 Vercel, Netlify, GitHub Pages 等静态网站托管服务。
*   **后端部署**：Supabase 提供托管服务，无需额外部署。

## 5. 数据模型设计

### 5.1 用户表

**表名**: `users`

| 字段名      | 类型        | 描述                 | 约束           |
| :---------- | :---------- | :------------------- | :------------- |
| `id`        | `UUID`      | 用户唯一标识符       | 主键，Supabase Auth 自动生成 |
| `email`     | `TEXT`      | 用户邮箱             | 唯一，非空     |
| `password`  | `TEXT`      | 用户密码（哈希存储） | 非空           |
| `username`  | `TEXT`      | 用户名               | 唯一，非空     |
| `avatar_url`| `TEXT`      | 用户头像 URL         | 可空           |
| `created_at`| `TIMESTAMP` | 创建时间             | 自动生成       |
| `updated_at`| `TIMESTAMP` | 更新时间             | 自动更新       |

### 5.2 诗词表

**表名**: `poems`

| 字段名      | 类型        | 描述                 | 约束           |
| :---------- | :---------- | :------------------- | :------------- |
| `id`        | `UUID`      | 诗词唯一标识符       | 主键，自动生成 |
| `title`     | `TEXT`      | 诗词标题             | 非空           |
| `author`    | `TEXT`      | 作者                 | 非空           |
| `dynasty`   | `TEXT`      | 朝代                 | 非空           |
| `content`   | `TEXT`      | 诗词内容             | 非空           |
| `background`| `TEXT`      | 创作背景             | 可空           |
| `annotation`| `TEXT`      | 注释                 | 可空           |
| `translation`| `TEXT`      | 译文                 | 可空           |
| `views`     | `INT`       | 浏览量               | 默认 0         |
| `likes_count`| `INT`       | 点赞数               | 默认 0         |
| `created_at`| `TIMESTAMP` | 创建时间             | 自动生成       |

### 5.3 赏析表

**表名**: `appreciations`

| 字段名      | 类型        | 描述                 | 约束           |
| :---------- | :---------- | :------------------- | :------------- |
| `id`        | `UUID`      | 赏析唯一标识符       | 主键，自动生成 |
| `poem_id`   | `UUID`      | 关联诗词 ID          | 外键 `poems.id`，非空 |
| `user_id`   | `UUID`      | 关联用户 ID          | 外键 `users.id`，非空 |
| `title`     | `TEXT`      | 赏析标题             | 非空           |
| `content`   | `TEXT`      | 赏析内容             | 非空           |
| `likes_count`| `INT`       | 点赞数               | 默认 0         |
| `status`    | `TEXT`      | 状态（草稿/已发布/审核中） | 默认 'draft'   |
| `created_at`| `TIMESTAMP` | 创建时间             | 自动生成       |
| `updated_at`| `TIMESTAMP` | 更新时间             | 自动更新       |

### 5.4 评论表

**表名**: `comments`

| 字段名      | 类型        | 描述                 | 约束           |
| :---------- | :---------- | :------------------- | :------------- |\n| `id`        | `UUID`      | 评论唯一标识符       | 主键，自动生成 |
| `user_id`   | `UUID`      | 关联用户 ID          | 外键 `users.id`，非空 |
| `poem_id`   | `UUID`      | 关联诗词 ID          | 外键 `poems.id`，可空 |
| `appreciation_id`| `UUID`      | 关联赏析 ID          | 外键 `appreciations.id`，可空 |
| `parent_comment_id`| `UUID`      | 父评论 ID (用于回复) | 外键 `comments.id`，可空 |
| `content`   | `TEXT`      | 评论内容             | 非空           |
| `created_at`| `TIMESTAMP` | 创建时间             | 自动生成       |

### 5.5 收藏表

**表名**: `collections`

| 字段名      | 类型        | 描述                 | 约束           |
| :---------- | :---------- | :------------------- | :------------- |
| `id`        | `UUID`      | 收藏唯一标识符       | 主键，自动生成 |
| `user_id`   | `UUID`      | 关联用户 ID          | 外键 `users.id`，非空 |
| `poem_id`   | `UUID`      | 关联诗词 ID          | 外键 `poems.id`，可空 |
| `appreciation_id`| `UUID`      | 关联赏析 ID          | 外键 `appreciations.id`，可空 |
| `created_at`| `TIMESTAMP` | 创建时间             | 自动生成       |
| `type`      | `TEXT`      | 收藏类型（诗词/赏析） | 非空           |

**注意**：`poem_id` 和 `appreciation_id` 在 `comments` 和 `collections` 表中至少有一个非空。

## 6. 接口设计 (API)

### 6.1 用户相关接口

Supabase 提供了内置的认证 API，以下为主要接口示例：

| API 路径                 | 方法 | 描述                 | 请求体示例                               | 响应体示例                                   |
| :----------------------- | :--- | :------------------- | :--------------------------------------- | :------------------------------------------- |
| `/auth/v1/signup`        | POST | 用户注册             | `{ "email": "user@example.com", "password": "password123" }` | `{ "access_token": "...", "user": { ... } }` |
| `/auth/v1/token`         | POST | 用户登录             | `{ "email": "user@example.com", "password": "password123" }` | `{ "access_token": "...", "user": { ... } }` |
| `/auth/v1/user`          | GET  | 获取当前用户信息     | 无                                       | `{ "id": "...", "email": "...", "username": "..." }` |
| `/auth/v1/user`          | PUT  | 更新当前用户信息     | `{ "username": "new_username", "avatar_url": "..." }` | `{ "id": "...", "email": "...", "username": "..." }` |
| `/auth/v1/recover`       | POST | 密码找回             | `{ "email": "user@example.com" }`      | `{ "message": "Recovery email sent" }`     |

### 6.2 诗词相关接口

| API 路径                 | 方法 | 描述                 | 请求参数/请求体示例                      | 响应体示例                                   |
| :----------------------- | :--- | :------------------- | :--------------------------------------- | :------------------------------------------- |
| `/rest/v1/poems`         | GET  | 获取诗词列表         | `?select=id,title,author&limit=10&offset=0` | `[ { "id": "...", "title": "...", "author": "..." } ]` |
| `/rest/v1/poems/{id}`    | GET  | 获取诗词详情         | 无                                       | `{ "id": "...", "title": "...", "content": "..." }` |
| `/rest/v1/poems`         | POST | 添加诗词 (管理员)    | `{ "title": "...", "author": "...", "content": "..." }` | `{ "id": "...", "title": "..." }`       |
| `/rest/v1/poems/{id}`    | PUT  | 更新诗词 (管理员)    | `{ "content": "new content" }`         | `{ "id": "...", "title": "..." }`       |
| `/rest/v1/poems/{id}`    | DELETE | 删除诗词 (管理员)    | 无                                       | `{ "message": "Poem deleted" }`            |
| `/rest/v1/poems?title=ilike.*%E6%98%A5%E6%99%93*` | GET | 搜索诗词 (按标题)    | `?title=ilike.*%E6%98%A5%E6%99%93*`       | `[ { "id": "...", "title": "春晓", ... } ]` |

### 6.3 赏析与评论相关接口

| API 路径                 | 方法 | 描述                 | 请求参数/请求体示例                      | 响应体示例                                   |
| :----------------------- | :--- | :------------------- | :--------------------------------------- | :------------------------------------------- |
| `/rest/v1/appreciations` | GET  | 获取赏析列表         | `?select=*,users(username)&poem_id=eq.{poem_id}` | `[ { "id": "...", "title": "...", "users": { "username": "..." } } ]` |
| `/rest/v1/appreciations` | POST | 提交赏析             | `{ "poem_id": "...", "user_id": "...", "title": "...", "content": "..." }` | `{ "id": "...", "title": "..." }`       |
| `/rest/v1/comments`      | GET  | 获取评论列表         | `?select=*,users(username)&poem_id=eq.{poem_id}` | `[ { "id": "...", "content": "...", "users": { "username": "..." } } ]` |
| `/rest/v1/comments`      | POST | 提交评论             | `{ "poem_id": "...", "user_id": "...", "content": "..." }` | `{ "id": "...", "content": "..." }`       |
| `/rest/v1/likes`         | POST | 点赞                 | `{ "user_id": "...", "target_id": "...", "type": "poem" }` | `{ "message": "Liked successfully" }`      |
| `/rest/v1/collections`   | POST | 收藏                 | `{ "user_id": "...", "poem_id": "...", "type": "poem" }` | `{ "message": "Collected successfully" }`  |


## 7. 附录

### 7.1 术语表

| 术语        | 解释                                         |
| :---------- | :------------------------------------------- |
| **Vue.js**  | 一套用于构建用户界面的渐进式 JavaScript 框架。 |
| **Supabase**| 一个开源的 Firebase 替代品，提供后端服务，包括数据库、认证、实时订阅和存储。 |
| **PostgreSQL**| 一个功能强大的开源对象关系型数据库系统。     |
| **API**     | 应用程序编程接口，定义了不同软件组件之间交互的规则。 |
| **RLS**     | 行级安全 (Row Level Security)，数据库安全策略，用于限制用户对特定行数据的访问。 |
| **UUID**    | 通用唯一标识符 (Universally Unique Identifier)，一种在分布式系统中生成唯一标识的算法。 |




### 7.2 参考资料

*   [Supabase 官方文档](https://supabase.com/docs) [1]
*   [Vue.js 官方文档](https://vuejs.org/guide/introduction.html) [2]
*   [PostgreSQL 官方文档](https://www.postgresql.org/docs/) [3]

