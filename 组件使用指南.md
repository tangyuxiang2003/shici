# 组件使用指南

## 1. 网络请求封装使用

### 1.1 基本使用

```javascript
// 在组件中使用
import { http } from '../utils/request'
import { poemApi } from '../api/poemApi'

// 方式一：使用 http 直接调用
const fetchPoems = async () => {
  try {
    const response = await http.get('/poems', { page: 1, limit: 10 })
    console.log(response.data)
  } catch (error) {
    console.error('请求失败:', error)
  }
}

// 方式二：使用封装好的 API
const fetchPoems = async () => {
  try {
    const poems = await poemApi.getPoems({ page: 1, limit: 10 })
    console.log(poems)
  } catch (error) {
    console.error('请求失败:', error)
  }
}
```

### 1.2 加载状态管理

```vue
<template>
  <div>
    <el-button @click="fetchData" :loading="loading">
      获取数据
    </el-button>
    
    <div v-if="loading">加载中...</div>
    <div v-else>{{ data }}</div>
  </div>
</template>

<script setup>
import { ref } from 'vue'
import { poemApi } from '../api/poemApi'

const loading = ref(false)
const data = ref(null)

const fetchData = async () => {
  if (loading.value) return
  
  loading.value = true
  try {
    data.value = await poemApi.getPoems()
  } catch (error) {
    console.error('请求失败:', error)
  } finally {
    loading.value = false
  }
}
</script>
```

## 2. PoemCard 组件使用

### 2.1 基础用法

```vue
<template>
  <PoemCard 
    :poem="poem" 
    :is-favorite="isFavorite"
    @favorite-toggle="handleFavoriteToggle"
    @view-detail="handleViewDetail"
  />
</template>

<script setup>
import { ref } from 'vue'
import PoemCard from '../components/PoemCard.vue'

const poem = ref({
  id: 1,
  title: '静夜思',
  author: '李白',
  dynasty: '唐代',
  content: '床前明月光，疑是地上霜。举头望明月，低头思故乡。',
  views: 1520,
  likes_count: 89
})

const isFavorite = ref(false)

const handleFavoriteToggle = (poem) => {
  console.log('收藏切换:', poem)
  isFavorite.value = !isFavorite.value
}

const handleViewDetail = (poem) => {
  console.log('查看详情:', poem)
}
</script>
```

### 2.2 使用插槽自定义

```vue
<template>
  <PoemCard :poem="poem">
    <template #header-actions>
      <el-button icon="Share" @click.stop="sharePoem" type="text" />
    </template>
    
    <template #actions>
      <el-button size="small" @click.stop="analyzePoem">赏析</el-button>
      <el-button size="small" type="primary" @click.stop="readAloud">朗读</el-button>
    </template>
  </PoemCard>
</template>
```

### 2.3 列表展示

```vue
<template>
  <div class="poems-container">
    <div v-for="poem in poems" :key="poem.id">
      <PoemCard 
        :poem="poem"
        :is-favorite="isFavorite(poem)"
        @favorite-toggle="toggleFavorite"
      />
    </div>
  </div>
</template>
```

## 3. SearchBox 组件使用

### 3.1 基础搜索

```vue
<template>
  <div>
    <SearchBox 
      v-model="keyword"
      placeholder="搜索诗词..."
      @search="handleSearch"
    />
    
    <div v-if="searchResults">
      搜索结果: {{ searchResults.length }} 条
    </div>
  </div>
</template>

<script setup>
import { ref } from 'vue'
import SearchBox from '../components/SearchBox.vue'

const keyword = ref('')
const searchResults = ref([])

const handleSearch = async (keyword) => {
  console.log('搜索关键词:', keyword)
  // 调用搜索API
  // searchResults.value = await searchApi.search(keyword)
}
</script>
```

### 3.2 带搜索建议

```vue
<template>
  <SearchBox 
    v-model="keyword"
    placeholder="搜索诗词、诗人..."
    :show-suggestions="true"
    @search="handleSearch"
    @suggestion-select="handleSuggestionSelect"
  />
</template>

<script setup>
import { ref } from 'vue'
import SearchBox from '../components/SearchBox.vue'

const keyword = ref('')

const handleSearch = (keyword) => {
  console.log('搜索:', keyword)
}

const handleSuggestionSelect = (suggestion) => {
  console.log('选择建议:', suggestion)
  // 根据建议类型进行不同处理
  switch (suggestion.type) {
    case 'poem':
      // 跳转到诗词详情
      break
    case 'author':
      // 跳转到诗人页面
      break
    case 'dynasty':
      // 按朝代筛选
      break
  }
}
</script>
```

## 4. 状态管理集成

### 4.1 与 Pinia 集成

```javascript
// stores/poemStore.js
import { defineStore } from 'pinia'
import { ref } from 'vue'
import { poemApi } from '../api/poemApi'

export const usePoemStore = defineStore('poem', () => {
  const poems = ref([])
  const favorites = ref([])
  const loading = ref(false)

  const fetchPoems = async (params = {}) => {
    loading.value = true
    try {
      poems.value = await poemApi.getPoems(params)
    } catch (error) {
      console.error('获取诗词失败:', error)
    } finally {
      loading.value = false
    }
  }

  const toggleFavorite = (poem) => {
    const index = favorites.value.findIndex(fav => fav.id === poem.id)
    if (index > -1) {
      favorites.value.splice(index, 1)
    } else {
      favorites.value.push(poem)
    }
  }

  const isFavorite = (poem) => {
    return favorites.value.some(fav => fav.id === poem.id)
  }

  return {
    poems,
    favorites,
    loading,
    fetchPoems,
    toggleFavorite,
    isFavorite
  }
})
```

### 4.2 在组件中使用 Store

```vue
<template>
  <div>
    <SearchBox @search="handleSearch" />
    
    <div v-if="poemStore.loading">加载中...</div>
    
    <div v-else class="poems-grid">
      <PoemCard 
        v-for="poem in poemStore.poems"
        :key="poem.id"
        :poem="poem"
        :is-favorite="poemStore.isFavorite(poem)"
        @favorite-toggle="poemStore.toggleFavorite"
      />
    </div>
  </div>
</template>

<script setup>
import { onMounted } from 'vue'
import { usePoemStore } from '../stores/poemStore'
import SearchBox from '../components/SearchBox.vue'
import PoemCard from '../components/PoemCard.vue'

const poemStore = usePoemStore()

const handleSearch = (keyword) => {
  poemStore.fetchPoems({ keyword })
}

onMounted(() => {
  poemStore.fetchPoems()
})
</script>
```

## 5. 错误处理最佳实践

### 5.1 统一错误处理

```javascript
// utils/errorHandler.js
import { ElMessage } from 'element-plus'

export const handleApiError = (error, defaultMessage = '操作失败') => {
  if (error.response) {
    const status = error.response.status
    const message = error.response.data?.message || defaultMessage
    ElMessage.error(message)
  } else if (error.request) {
    ElMessage.error('网络连接异常，请检查网络设置')
  } else {
    ElMessage.error(error.message || defaultMessage)
  }
  
  console.error('API错误:', error)
}
```

### 5.2 在组件中使用错误处理

```vue
<script setup>
import { ref } from 'vue'
import { poemApi } from '../api/poemApi'
import { handleApiError } from '../utils/errorHandler'

const loading = ref(false)

const fetchPoems = async () => {
  loading.value = true
  try {
    await poemApi.getPoems()
  } catch (error) {
    handleApiError(error, '获取诗词列表失败')
  } finally {
    loading.value = false
  }
}
</script>
```

## 6. 性能优化建议

### 6.1 防抖搜索

```vue
<script setup>
import { ref } from 'vue'
import { debounce } from 'lodash-es'

const keyword = ref('')
const searchResults = ref([])

// 防抖搜索，300ms延迟
const debouncedSearch = debounce(async (keyword) => {
  if (!keyword.trim()) return
  
  try {
    // searchResults.value = await searchApi.search(keyword)
  } catch (error) {
    console.error('搜索失败:', error)
  }
}, 300)

const handleInput = (value) => {
  debouncedSearch(value)
}
</script>
```

### 6.2 虚拟滚动（大数据量时）

```vue
<template>
  <el-table-v2
    :columns="columns"
    :data="poems"
    :height="400"
    fixed
  />
</template>
```

## 7. 测试示例

### 7.1 组件单元测试

```javascript
// PoemCard.spec.js
import { mount } from '@vue/test-utils'
import PoemCard from '../PoemCard.vue'

describe('PoemCard', () => {
  it('渲染诗词信息', () => {
    const poem = {
      id: 1,
      title: '测试诗词',
      author: '测试作者',
      content: '测试内容'
    }
    
    const wrapper = mount(PoemCard, {
      props: { poem }
    })
    
    expect(wrapper.text()).toContain('测试诗词')
    expect(wrapper.text()).toContain('测试作者')
  })
})
```

## 8. 部署配置

### 8.1 环境变量配置

```env
# .env.production
VITE_API_BASE_URL=https://api.yoursite.com
VITE_ENABLE_DEBUG=false
```

### 8.2 构建配置

```javascript
// vite.config.js
export default {
  build: {
    outDir: 'dist',
    sourcemap: false,
    minify: 'terser'
  }
}
```

通过遵循这些指南，您可以高效地使用封装的组件和API，构建出可维护、高性能的诗词赏析应用。